{% extends "base.html" %}
{% block title %}Deep Research - Troveing{% endblock %}
{% block page_title %}Deep Research{% endblock %}
{% block content %}
<div class="research-container">
  <div class="research-form-section">
    <h2>Start Deep Research</h2>
    <form id="researchForm" class="research-form">
      <div class="form-group">
        <label for="question">Research Question *</label>
        <textarea id="question" name="question" rows="3" required 
                  placeholder="e.g., History of phosphate mining approvals in NSW's North Coast (1970â€“1995)">{{ seed_query }}</textarea>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="region">Region (optional)</label>
          <input type="text" id="region" name="region" 
                 placeholder="e.g., Clarence Valley, NSW" value="Clarence Valley, NSW">
        </div>
        
        <div class="form-group">
          <label for="time_window">Time Window (optional)</label>
          <input type="text" id="time_window" name="time_window" 
                 placeholder="e.g., 1970â€“1995 or last 5 years">
        </div>
      </div>
      
      <div class="form-group">
        <label for="depth">Research Depth</label>
        <div class="radio-group">
          <label><input type="radio" name="depth" value="brief" id="depth-brief"> Brief</label>
          <label><input type="radio" name="depth" value="standard" id="depth-standard" checked> Standard</label>
          <label><input type="radio" name="depth" value="deep" id="depth-deep"> Deep</label>
        </div>
      </div>
      
      <button type="submit" class="btn-primary" id="startBtn">Start Research</button>
    </form>
    
    <section style="margin:12px 0;padding:12px;border:1px solid #ddd;border-radius:12px">
      <b>Quick samples</b>
      <ul id="sample-list" style="margin-top:8px"></ul>
    </section>
  </div>
  
  <div class="research-progress-section" id="progressSection" style="display: none;">
    <h2>Research Progress</h2>
    <div class="progress-bar-container">
      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
      <div class="progress-text" id="progressText">0%</div>
    </div>
    <div class="progress-status" id="progressStatus">Initializing...</div>
  </div>
  
  <div class="research-results-section" id="resultsSection" style="display: none;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border, #222831);">
      <h2 style="margin: 0; font-size: 1.75rem; font-weight: 700; color: var(--fg, #e7eaee);">Research Findings</h2>
      <div class="report-actions" style="display: flex; gap: 0.75rem;">
        <a href="#" id="downloadMd" class="btn-secondary" download>ðŸ“„ Download Markdown</a>
        <a href="#" id="downloadJsonl" class="btn-secondary" download>ðŸ“¦ Download Evidence (JSONL)</a>
      </div>
    </div>
    <div class="report-content" id="reportContent">
      <div class="empty-state">
        <div class="empty-state-icon">ðŸ“Š</div>
        <p>Loading report...</p>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="{{ static_url(request, 'static/css/research.css') }}">
<script src="{{ static_url(request, 'static/js/research.js') }}"></script>
<script>
(async function(){
  try{
    const res = await fetch("/static/samples/research_samples.json");
    const data = await res.json();
    const ul = document.querySelector("#sample-list");
    (data.samples||[]).forEach(s=>{
      const li=document.createElement("li"); li.style.margin="6px 0";
      const a=document.createElement("a"); a.href="#"; a.textContent="â–¶ "+s.label; a.onclick=(e)=>{
        e.preventDefault();
        const q = document.querySelector("#question");
        const tw = document.querySelector("#time_window");
        if(q) q.value = s.query;
        if(tw) tw.value = (s.years_from||"") + "-" + (s.years_to||"");
        const btn = document.querySelector("#startBtn");
        if(btn) btn.click();
      };
      li.appendChild(a); ul.appendChild(li);
    });
  }catch(e){ console.error(e); }
})();
</script>
{% endblock %}

